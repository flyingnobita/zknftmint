<!doctype html>
<html>
<head>
  <title>zknftmint</title>
</head>
<body>

  <h1>Mint an NFT if you can prove knowledge of a preimage</h1>
  <p>See <a href="https://github.com/weijiekoh/zknftmint">zknftmint</a>.</p>

  <p>Your address: <input id="address" /></p>
  <p>The secret: <input id="secret" /></p>

  <button id="bGenProof">Create proof </button>

  <pre class="time">Time taken: <code id="time"></code></pre>
  <pre class="proof">Valid?: <code id="result"></code></pre>
  <pre class="nullifier">Nullifier: <code id="nullifier"></code></pre>
  <pre class="proof">Proof:
<code id="proof"></code>
  </pre>

  <script src="./snarkjs.min.js">   </script>
  <script>

const proofCompnent = document.getElementById('proof');
const resultComponent = document.getElementById('result');
const timeComponent = document.getElementById('time');
const bGenProof = document.getElementById("bGenProof");
const address = document.getElementById("address");
const nullifier = document.getElementById("nullifier");
const secret = document.getElementById("secret");

bGenProof.addEventListener("click", calculateProof);

async function calculateProof() {
    const circuitInputs = {
        hash: BigInt('1121645852825515626345503741442177404306361956507933536148868635850297893661'),
        address: BigInt(address.value),
        preimage: BigInt(secret.value),
    };

      console.log(circuitInputs)

    const start = Date.now();

    const { proof, publicSignals } =
      await snarkjs.groth16.fullProve(
        circuitInputs,
        "zkeys/NftMint_.prod.wasm",
        "zkeys/NftMint_.prod.0.zkey",
      );

    const end = Date.now();
    const timeTaken = ((end - start) / 1000).toString() + ' seconds';

    timeComponent.innerHTML = timeTaken;

    const proofForTx = [
        proof.pi_a[0],
        proof.pi_a[1],
        proof.pi_b[0][1],
        proof.pi_b[0][0],
        proof.pi_b[1][1],
        proof.pi_b[1][0],
        proof.pi_c[0],
        proof.pi_c[1],
    ];

      const proofAsStr = JSON.stringify(
            proofForTx.map((x) => BigInt(x).toString(10)),
      ).split('\n').join().replaceAll('"', '')

    proofCompnent.innerHTML = proofAsStr

    nullifier.innerHTML = BigInt(publicSignals[0]).toString()

    const vkey = await fetch("zkeys/verification_key.json").then( function(res) {
        return res.json();
    });

    const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);

    resultComponent.innerHTML = res;
}

  </script>

</body>
</html>

